# -- Container registry (e.g. ghcr.io)
# -- Set by pipeline via --set-string
global:
  # -- GitHub repository path (e.g. bcgov/soba)
  repository: ~
  # -- Container registry hostname
  registry: ghcr.io
  # -- Image tag (e.g. sha-abc1234, pr-42, latest)
  tag: ~
  # -- Enable HorizontalPodAutoscaler for all components
  autoscaling: false
  # -- Database secrets pulled from CrunchyDB operator
  secrets:
    # -- Enable CrunchyDB secret lookup
    enabled: true
    databasePassword: ~
    databaseName: ~
    # -- Keep secrets on helm uninstall
    persist: true
  config:
    # -- CrunchyDB user (appproxy for main, app-{N} for PRs)
    databaseUser: ~
  # -- OpenShift apps domain
  domain: "apps.silver.devops.gov.bc.ca"
  # -- CrunchyDB cluster release name (set by pipeline)
  databaseAlias: ~

# -- Backend (Express API on port 4000)
backend:
  # -- Enable backend deployment
  enabled: true
  # -- Deployment update strategy
  deploymentStrategy: Recreate
  autoscaling:
    enabled: true
    minReplicas: 3
    maxReplicas: 7
    targetCPUUtilizationPercentage: 80
  service:
    type: ClusterIP
    port: 80
    targetPort: 4000
  pdb:
    enabled: false
    minAvailable: 1

# -- Frontend (Next.js on port 3000)
frontend:
  # -- Enable frontend deployment
  enabled: true
  # -- Deployment update strategy
  deploymentStrategy: Recreate
  autoscaling:
    enabled: true
    minReplicas: 3
    maxReplicas: 7
    targetCPUUtilizationPercentage: 80
  service:
    enabled: true
    type: ClusterIP
    ports:
      - name: http
        port: 80
        targetPort: 3000
        protocol: TCP
  ingress:
    annotations:
      haproxy.router.openshift.io/balance: "roundrobin"
      route.openshift.io/termination: "edge"
      haproxy.router.openshift.io/rate-limit-connections: "true"
      haproxy.router.openshift.io/rate-limit-connections.concurrent-tcp: "10"
      haproxy.router.openshift.io/rate-limit-connections.rate-http: "20"
      haproxy.router.openshift.io/rate-limit-connections.rate-tcp: "50"
      haproxy.router.openshift.io/disable_cookies: "true"
  pdb:
    enabled: false
    minAvailable: 1
