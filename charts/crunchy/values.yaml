# Base CrunchyDB reference values â€” NOT used directly.
# The action only reads the environment-specific file (values-dev.yaml, values-test.yaml, values-prod.yaml).
# Each environment file must be self-contained.
crunchy:
  # -- Database name
  pgDatabase: soba
  # -- PostgreSQL major version
  postgresVersion: 16
  # -- Enable OpenShift-specific settings
  openshift: true

  # -- High-availability instances
  instances:
    - name: db
      replicas: 2
      dataVolumeClaimSpec:
        storage: 1Gi
        storageClassName: netapp-block-standard
      walVolumeClaimSpec:
        storage: 1Gi
        storageClassName: netapp-block-standard
      requests:
        cpu: 50m
        memory: 128Mi
      limits:
        cpu: 250m
        memory: 256Mi

  # -- pgBackRest backup configuration
  pgBackRestConfig:
    repos:
      - name: repo1
        volume:
          volumeClaimSpec:
            storage: 4Gi
            storageClassName: netapp-file-backup
        schedules:
          full: "0 8 * * *"
          incremental: "0 0-7,9-23 * * *"
        retention:
          full: 2
          fullType: count

  # -- pgBouncer connection pooling proxy
  pgBouncerConfig:
    replicas: 2
    requests:
      cpu: 10m
      memory: 64Mi
    limits:
      cpu: 50m
      memory: 128Mi
    config:
      global:
        pool_mode: transaction
        max_client_conn: "100"
        default_pool_size: "20"
        min_pool_size: "2"

  # -- pgMonitor Prometheus exporter
  pgmonitor:
    enabled: true
    exporter:
      image: ~

  # -- Patroni HA settings
  patroni:
    postgresql:
      parameters:
        shared_buffers: 128MB
        effective_cache_size: 256MB
        work_mem: 4MB
        maintenance_work_mem: 64MB
        max_connections: "100"
        password_encryption: scram-sha-256
